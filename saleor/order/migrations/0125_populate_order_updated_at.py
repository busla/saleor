# Generated by Django 3.2.12 on 2022-02-09 13:58

from django.db import migrations


def populate_orders_updated_at_date_from_events(apps, _schema_editor):
    Order = apps.get_model("order", "Order")

    for order in Order.objects.filter(updated_at__isnull=True).iterator():
        last_event = order.events.last()
        if last_event:
            order.updated_at = last_event.date
        else:
            order.updated_at = order.created
        order.save(update_fields=["updated_at"])


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("order", "0124_order_updated_at"),
    ]

    operations = [
        migrations.RunPython(
            populate_orders_updated_at_date_from_events,
            migrations.RunPython.noop,
        ),
    ]
